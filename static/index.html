<!doctype html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ‰‹æœºå…‰æ ‡æ§åˆ¶å™¨</title>
<style>
  body { margin:0; font-family:sans-serif; display:flex; flex-direction:column; align-items:center; height:100vh; user-select:none; background:#f5f5f5;}
  h2 { margin:10px 0; }
  #touchArea { width:90%; height:300px; background:#e0e0e0; border:2px dashed #aaa; border-radius:12px; margin:20px 0; display:flex; align-items:center; justify-content:center; color:#555; font-size:18px; touch-action:none; }
  .buttons { display:flex; justify-content:space-around; width:90%; margin-bottom:10px; }
  button { width:45%; padding:15px; font-size:18px; border:none; border-radius:8px; background:#007bff; color:#fff; cursor:pointer; }
  button:active { background:#0056b3; }
  .arrows { display:flex; justify-content:center; margin-bottom:20px; gap:10px; }
  .arrow-btn { padding:15px 20px; font-size:18px; border:none; border-radius:8px; background:#28a745; color:#fff; cursor:pointer; }
  .arrow-btn:active { background:#1e7e34; }
</style>
</head>
<body>

<h2>ğŸ“± æ‰‹æœºæ§åˆ¶é¼ æ ‡</h2>

<div id="touchArea">æ»‘åŠ¨æ­¤åŒºåŸŸæ§åˆ¶é¼ æ ‡</div>

<div class="buttons">
  <button id="leftClick">å·¦é”®</button>
  <button id="rightClick">å³é”®</button>
</div>

<div class="arrows">
  <button class="arrow-btn" data-key="up">â†‘</button>
  <button class="arrow-btn" data-key="down">â†“</button>
  <button class="arrow-btn" data-key="left">â†</button>
  <button class="arrow-btn" data-key="right">â†’</button>
</div>

<script>
  // å»ºç«‹ä¸¤ä¸ª WebSocketï¼šé¼ æ ‡ç§»åŠ¨/ç‚¹å‡»é”®ç›˜
  const wsMouseMove = new WebSocket("ws://10.18.133.7:8000/ws/mouse_move");
  const wsAction = new WebSocket("ws://10.18.133.7:8000/ws/action");

  wsMouseMove.onopen = () => console.log("é¼ æ ‡ WebSocket å·²è¿æ¥");
  wsMouseMove.onclose = () => console.log("é¼ æ ‡ WebSocket å·²å…³é—­");
  wsMouseMove.onerror = e => console.error("é¼ æ ‡ WebSocket å‡ºé”™:", e);

  wsAction.onopen = () => console.log("æ§åˆ¶ WebSocket å·²è¿æ¥");
  wsAction.onclose = () => console.log("æ§åˆ¶ WebSocket å·²å…³é—­");
  wsAction.onerror = e => console.error("æ§åˆ¶ WebSocket å‡ºé”™:", e);

  // å‘é€å‡½æ•°
  function sendMouseCommand(type, payload) {
    if(wsMouseMove.readyState === WebSocket.OPEN){
      wsMouseMove.send(JSON.stringify({ type, payload }));
    }
  }

  function sendActionCommand(type, payload) {
    if(wsAction.readyState === WebSocket.OPEN){
      wsAction.send(JSON.stringify({ type, payload }));
    }
  }

  // å·¦å³é”®
  document.getElementById("leftClick").onclick = () => sendActionCommand("mouse_click", { button:"left" });
  document.getElementById("rightClick").onclick = () => sendActionCommand("mouse_click", { button:"right" });

  // æ–¹å‘é”®
  document.querySelectorAll(".arrow-btn").forEach(btn => {
    btn.onclick = () => sendActionCommand("keyboard_press", { key: btn.dataset.key });
  });

  // é¼ æ ‡ç§»åŠ¨è§¦æ‘¸åŒºåŸŸ
  const touchArea = document.getElementById("touchArea");
  let lastX = 0, lastY = 0;
  let ticking = false; // ç”¨ requestAnimationFrame é™åˆ¶å‘é€é¢‘ç‡

  touchArea.addEventListener("touchstart", e => {
    const t = e.touches[0];
    lastX = t.clientX;
    lastY = t.clientY;
  });

  touchArea.addEventListener("touchmove", e => {
    e.preventDefault();
    const t = e.touches[0];
    const dx = t.clientX - lastX;
    const dy = t.clientY - lastY;
    lastX = t.clientX;
    lastY = t.clientY;

    if(!ticking){
      window.requestAnimationFrame(() => {
        sendMouseCommand("mouse_move", { dx, dy });
        ticking = false;
      });
      ticking = true;
    }
  });

</script>
</body>
</html>