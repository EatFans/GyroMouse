<!doctype html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>手机光标控制器</title>
<style>
  body { margin:0; font-family:sans-serif; display:flex; flex-direction:column; align-items:center; height:100vh; user-select:none; background:#f5f5f5;}
  h2 { margin:10px 0; }
  #touchArea { width:90%; height:300px; background:#e0e0e0; border:2px dashed #aaa; border-radius:12px; margin:20px 0; display:flex; align-items:center; justify-content:center; color:#555; font-size:18px; touch-action:none; }
  .buttons { display:flex; justify-content:space-around; width:90%; margin-bottom:10px; }
  button { width:45%; padding:15px; font-size:18px; border:none; border-radius:8px; background:#007bff; color:#fff; cursor:pointer; }
  button:active { background:#0056b3; }
  .arrows { display:flex; justify-content:center; margin-bottom:20px; gap:10px; }
  .arrow-btn { padding:15px 20px; font-size:18px; border:none; border-radius:8px; background:#28a745; color:#fff; cursor:pointer; }
  .arrow-btn:active { background:#1e7e34; }
</style>
</head>
<body>

<h2>手机控制鼠标</h2>

<div id="touchArea">滑动此区域控制鼠标</div>

<div class="buttons">
  <button id="leftClick">左键</button>
  <button id="rightClick">右键</button>
</div>

<div class="arrows">
  <button class="arrow-btn" data-key="up">↑</button>
  <button class="arrow-btn" data-key="down">↓</button>
  <button class="arrow-btn" data-key="left">←</button>
  <button class="arrow-btn" data-key="right">→</button>
</div>

<script>
  // 建立两个 WebSocket：鼠标移动/点击键盘
  const wsMouseMove = new WebSocket("ws://10.18.133.7:8000/ws/mouse_move");
  const wsAction = new WebSocket("ws://10.18.133.7:8000/ws/action");

  wsMouseMove.onopen = () => console.log("鼠标 WebSocket 已连接");
  wsMouseMove.onclose = () => console.log("鼠标 WebSocket 已关闭");
  wsMouseMove.onerror = e => console.error("鼠标 WebSocket 出错:", e);

  wsAction.onopen = () => console.log("控制 WebSocket 已连接");
  wsAction.onclose = () => console.log("控制 WebSocket 已关闭");
  wsAction.onerror = e => console.error("控制 WebSocket 出错:", e);

  // 发送函数
  function sendMouseCommand(type, payload) {
    if(wsMouseMove.readyState === WebSocket.OPEN){
      wsMouseMove.send(JSON.stringify({ type, payload }));
    }
  }

  function sendActionCommand(type, payload) {
    if(wsAction.readyState === WebSocket.OPEN){
      wsAction.send(JSON.stringify({ type, payload }));
    }
  }

  // 左右键
  document.getElementById("leftClick").onclick = () => sendActionCommand("mouse_click", { button:"left" });
  document.getElementById("rightClick").onclick = () => sendActionCommand("mouse_click", { button:"right" });

  // 方向键
  document.querySelectorAll(".arrow-btn").forEach(btn => {
    btn.onclick = () => sendActionCommand("keyboard_press", { key: btn.dataset.key });
  });

  // 鼠标移动触摸区域
  const touchArea = document.getElementById("touchArea");
  let lastX = 0, lastY = 0;
  let ticking = false; // 用 requestAnimationFrame 限制发送频率

  touchArea.addEventListener("touchstart", e => {
    const t = e.touches[0];
    lastX = t.clientX;
    lastY = t.clientY;
  });

  touchArea.addEventListener("touchmove", e => {
    e.preventDefault();
    const t = e.touches[0];
    const dx = t.clientX - lastX;
    const dy = t.clientY - lastY;
    lastX = t.clientX;
    lastY = t.clientY;

    if(!ticking){
      window.requestAnimationFrame(() => {
        sendMouseCommand("mouse_move", { dx, dy });
        ticking = false;
      });
      ticking = true;
    }
  });

</script>
</body>
</html>